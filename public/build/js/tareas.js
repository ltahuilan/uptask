!function(){!async function(){try{const t="/api/tarea?url="+i(),a=await fetch(t),n=await a.json();e=n.tareas,o()}catch(e){console.log(e)}}();let e=[],t=[];const a={0:"Pendiente",1:"Completa"};document.querySelector("#nueva-tarea").addEventListener("click",(function(){r()}));function n(a){const n=a.target.value;""!==n?(t=e.filter(e=>e.estado===n),o()):t=[],o()}function o(){document.querySelector("#lista-tareas").innerHTML="",function(){const t=e.filter(e=>"1"===e.estado),a=document.querySelector("#completas");0===t.length?a.disabled=!0:a.disabled=!1}(),function(){const t=e.filter(e=>"0"===e.estado),a=document.querySelector("#pendientes");0===t.length?a.disabled=!0:a.disabled=!1}();const n=t.length?t:e,d=document.querySelector("#lista-tareas");if(0===n.length){const e=document.createElement("LI");return e.classList.add("no-tareas"),e.innerHTML="No Hay tareas",void d.appendChild(e)}n.forEach(t=>{const n=document.createElement("LI");n.dataset.tareaId=t.id,n.classList.add("tarea");const s=document.createElement("P");s.textContent=t.nombre,s.ondblclick=function(){r(!0,{...t})};const l=document.createElement("DIV");l.classList.add("opciones");const u=document.createElement("BUTTON");u.classList.add("estado-tarea"),u.classList.add((""+a[t.estado]).toLowerCase()),u.dataset.tareaEstado=t.estado,u.textContent=""+a[t.estado],u.onclick=function(){!function(e){nuevoEstado="1"===e.estado?"0":"1",e.estado=nuevoEstado,c(e)}(t)};const m=document.createElement("BUTTON");m.classList.add("eliminar-tarea"),m.dataset.eliminarTarea=t.id,m.textContent="Eliminar",m.onclick=function(){!function(t){Swal.fire({title:"Eliminar tarea?",text:"Este cambio no puede revertirse!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#2563EB",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!"}).then(a=>{a.isConfirmed&&async function(t){const{id:a,nombre:n,estado:r,proyectoId:c}=t,d=new FormData;d.append("id",a),d.append("nombre",n),d.append("estado",r),d.append("proyectoId",i());try{const a=location.origin+"/api/tarea/eliminar",n=await fetch(a,{method:"POST",body:d}),r=await n.json();"exito"===r.tipo&&(Swal.fire(r.mensaje,"","success"),e=e.filter(e=>e.id!==t.id),o())}catch(e){console.log(e)}}(t)})}(t)},l.appendChild(u),l.appendChild(m),n.appendChild(s),n.appendChild(l),d.appendChild(n)})}function r(t=!1,a={}){const n=document.createElement("DIV");n.classList.add("modal"),n.innerHTML=`\n        <form class="formulario" method="POST" action="/api/tarea">\n            <legend>${t?"Editar Tarea":"Agregar Tarea"}</legend>\n            <div class="campo">\n                <label for="tarea">Nombre Tarea</label>\n                <input \n                    type="text"\n                    name="tarea"\n                    id="tarea"\n                    placeholder="${t?"Editar nombre de la tarea":"Agrega una nueva tarea"}"\n                    value="${t?a.nombre:""}"\n                />\n            </div>\n            <div class="opciones">\n                <input\n                    type="submit"\n                    class="btn-crear-tarea"\n                    value="${t?"Guardar Cambios":"Crear tarea"}"\n                />\n                <button type="button" class="btn-cerrar-modal">Cerrar</button>\n            </div>\n        </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},250),n.addEventListener("click",(function(r){if(r.preventDefault(),r.target.classList.contains("btn-cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{n.remove()},350)}if(r.target.classList.contains("btn-crear-tarea")){const n=document.querySelector("#tarea").value.trim(),r=document.querySelector("#tarea").name;if(""===n)return void function(e,t,a){const n=document.querySelector(".alerta");n&&n.remove();const o=document.createElement("DIV");o.classList.add("alerta",e),o.textContent=t,a.parentElement.insertBefore(o,a.nextElementSibling),setTimeout(()=>{o.remove()},4e3)}("error",`El campo ${r} no puede estar vacÃ­o`,document.querySelector(".formulario legend"));t?(a.nombre=n,c(a)):async function(t){const a=new FormData;a.append("nombre",t),a.append("url",i());try{const n=location.origin+"/api/tarea",r=await fetch(n,{method:"POST",body:a}),c=await r.json();if("exito"===c.tipo){const a=document.querySelector(".modal"),n={id:String(c.id),nombre:t,estado:"0",proyectoId:c.proyectoId};e=[...e,n],o(),a.remove(),Swal.fire(c.mensaje,"","success")}}catch(e){console.log(e)}}(n)}})),document.querySelector(".dashboard").appendChild(n)}async function c(t){const{id:a,nombre:n,estado:r,proyectoId:c}=t;datos=new FormData,datos.append("id",a),datos.append("nombre",n),datos.append("estado",r),datos.append("proyectoId",i());try{if(url=location.origin+"/api/tarea/actualizar",respuesta=await fetch(url,{method:"POST",body:datos}),resultado=await respuesta.json(),"exito"===resultado.tipo){const a=document.querySelector(".modal");a&&a.remove(),Swal.fire(resultado.mensaje,"","success"),e=e.map(e=>(e.id===t.id&&(e.estado=r,e.nombre=n),e)),o()}}catch(e){console.log(e)}}function i(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e).url}document.querySelectorAll('#filtros input[type="radio"').forEach((function(e){e.addEventListener("input",n)}))}();